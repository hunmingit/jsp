// ---------------------------------------------
// 1. 다운로드 버튼(a 태그) 가져오기
// ---------------------------------------------
// 첨부파일이 없으면 JSP에서 download 링크 자체를 만들지 않기 때문에
// querySelector("#download") 결과가 null이 될 수도 있음!
// → 안전하게 null 체크해야 오류 방지됨.
const aEle = document.querySelector("#download");


// ---------------------------------------------
// 2. 다운로드 버튼이 존재할 때만 이벤트 적용
// ---------------------------------------------
if (aEle != null) {

    // ---------------------------------------------
    // 3. 클릭 이벤트 등록
    // ---------------------------------------------
    aEle.addEventListener('click', (e) => {

        // ---------------------------------------------
        // 4. a 태그의 기본 동작 막기
        // ---------------------------------------------
        // a 태그는 클릭하면 바로 href로 이동하는데,
        // 우리는 직접 쿼리스트링을 만들어 컨트롤러에 보내야 하므로
        // 기본 이동 동작을 막아야 한다.
        e.preventDefault();

        // ---------------------------------------------
        // 5. 클릭한 요소(e.target)의 href 속성값 가져오기
        // ---------------------------------------------
        // e.target == 클릭한 a 태그
        // href에는 실제 파일명(예: "test.png")이 들어있도록 JSP에서 설정해둠.
        let filename = e.target.getAttribute("href");

        // ---------------------------------------------
        // 6. 서블릿에 전달할 쿼리스트링 생성
        // ---------------------------------------------
        // cmd=download → 컨트롤러가 "다운로드 기능" 수행하도록 지시
        // filename=파일명 → 어떤 파일을 다운로드할지 전달
        let sendData = `cmd=download&filename=${filename}`;

        // ---------------------------------------------
        // 7. location.href로 컨트롤러 호출
        // ---------------------------------------------
        // 아래 코드 실행 시 브라우저가 URL로 이동함.
        // BBSController에서 cmd가 download일 때 파일 다운로드 로직 실행됨.
        location.href = `BBSController?${sendData}`;

        // ↓ 아래처럼 문자열 더하기 방식도 똑같이 작동함
        // location.href = 'BBSController?' + sendData;
    });
}
